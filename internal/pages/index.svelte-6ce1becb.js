import{S as e,i as t,s as n,e as a,c as s,b as r,f as i,J as o,I as c,d as l,D as u,a as d,K as p,E as f,F as m,G as $,x as h,u as y,L as g,M as b,N as w,O,P as v,Q as k,R as E,T as j,U as P,V as I,W as x,k as A,j as L,n as T,m as N,o as q,v as C,w as S,X as R,t as F,g as Q,H as V,Y as B,Z as D,_ as U,r as W}from"../chunks/vendor-48081fe7.js";function J(e){let t,n,u;return{c(){t=a("input"),this.h()},l(e){t=s(e,"INPUT",{type:!0,accept:!0}),this.h()},h(){r(t,"type","file"),r(t,"accept",".geojson,.gpx")},m(a,s){i(a,t,s),n||(u=o(t,"change",e[1]),n=!0)},p:c,i:c,o:c,d(e){e&&l(t),n=!1,u()}}}function M(e,t,n){let{files:a}=t;return e.$$set=e=>{"files"in e&&n(0,a=e.files)},[a,function(){a=this.files,n(0,a)}]}class G extends e{constructor(e){super(),t(this,e,M,J,n,{files:0})}}function H(e){let t,n,c,g;const b=e[5].default,w=u(b,e,e[4],null);return{c(){t=a("button"),w&&w.c(),this.h()},l(e){t=s(e,"BUTTON",{class:!0});var n=d(t);w&&w.l(n),n.forEach(l),this.h()},h(){r(t,"class","button"),p(t,"clicked",e[1]),p(t,"disabled",e[0])},m(a,s){i(a,t,s),w&&w.m(t,null),n=!0,c||(g=o(t,"click",e[2]),c=!0)},p(e,[a]){w&&w.p&&(!n||16&a)&&f(w,b,e,e[4],n?$(b,e[4],a,null):m(e[4]),null),2&a&&p(t,"clicked",e[1]),1&a&&p(t,"disabled",e[0])},i(e){n||(h(w,e),n=!0)},o(e){y(w,e),n=!1},d(e){e&&l(t),w&&w.d(e),c=!1,g()}}}function X(e,t,n){let{$$slots:a={},$$scope:s}=t,{name:r}=t,{disabled:i=!1}=t;const o=g();let c;return e.$$set=e=>{"name"in e&&n(3,r=e.name),"disabled"in e&&n(0,i=e.disabled),"$$scope"in e&&n(4,s=e.$$scope)},[i,c,e=>{if(n(1,c=!0),setTimeout((()=>n(1,c=!1)),100),!i)return o("click",r)},r,s,a]}class _ extends e{constructor(e){super(),t(this,e,X,H,n,{name:3,disabled:0})}}var K=(e,t)=>{const n=t+".geojson";let a=JSON.stringify(e),s="data:application/json;charset=utf-8,"+encodeURIComponent(a),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",n),r.setAttribute("download",n),r.click(),r.remove()},Y=e=>new Promise(((t,n)=>{const a=e.name.split(".").pop();if(!e||"geojson"!==a&&"gpx"!==a)return n(new Error("Format not supported. Please provide a .geojson or .gpx."));{const s=new FileReader;s.addEventListener("load",(()=>{const e=s.result;return e?t("geojson"===a?JSON.parse(e):b((new DOMParser).parseFromString(e,"text/xml"))):n(new Error("Could not read the provided file."))})),s.readAsText(e)}})),Z=(e,t)=>{let n;if("FeatureCollection"===e.type)n=e.features[0];else{if("Feature"!==e.type)throw new Error("No Feature found in GeoJson");n=e}return w(n,t,{units:"kilometers"})},z=async(e,t,n,a=1)=>{let s=await Y(e),r=Z(s,a);console.log(r);let i=O(r,{highQuality:!0,mutate:!1,tolerance:.05});console.log(i);let o="";i.geometry.coordinates[0].map((e=>{o+=e[1]+" "+e[0]+" "})),o=o.trimEnd();let c="";t.map((e=>c+=`way["${Object.keys(e)[0]}"="${e[Object.keys(e)[0]]}"](poly:"${o}");`));const l=`[out:json][timeout:150];(${c});(._;>;);out meta;`,u=await(async e=>{const t=await fetch("https://overpass-api.de/api/interpreter?data="+encodeURIComponent(e),{mode:"cors",headers:{"Content-Type":"application/json"}});return await t.json()})(l);console.log(u);let d=v(u);console.log(d),K(d,n)};var ee=[{name:"Supermarket and convenience store",query:[{shop:"convenience"},{shop:"supermarket"}]},{name:"Bicycle shop",query:[{shop:"bicycle"}]},{name:"Playground",query:[{leisure:"playground"}]},{name:"Bakery",query:[{shop:"bakery"}]},{name:"CafÃ© and restaurant",query:[{amenity:"cafe"},{amenity:"restaurant"}]},{name:"Benches",query:[{amenity:"bench"}]}];class te{constructor(e="https://query.wikidata.org/sparql"){this.endpoint=e}query(e,t=!0){const n=this.endpoint+"?query="+encodeURIComponent(e);return fetch(n,{headers:{Accept:"application/sparql-results+json"}}).then((e=>e.json())).then((e=>t?this.simplify(e):e))}simplify(e){return e.results.bindings.map((e=>(Object.keys(e).forEach((function(t,n){e[t]=e[t].value})),e)))}}var ne=[{name:"Road",id:"Q34442",instanceOf:!0,subclassOf:!0},{name:"Cemetery",id:"Q39614",instanceOf:!0,subclassOf:!1},{name:"Accident",id:"Q171558",instanceOf:!0,subclassOf:!1},{name:"Farmhouse",id:"Q489357",instanceOf:!0,subclassOf:!1},{name:"Municipality section",id:"Q2785216",instanceOf:!0,subclassOf:!1},{name:"Viaduc",id:"Q181348",instanceOf:!0,subclassOf:!1},{name:"Railway tunnel",id:"Q1311958",instanceOf:!0,subclassOf:!1},{name:"Prisons",id:"Q40357",instanceOf:!0,subclassOf:!1}];var ae=e=>k(e.map((e=>{const t=e.location.replace("Point(","").replace(")","").split(" ").map(Number);return delete e.location,E(t,e)}))),se=async(e,t=1)=>{const n=new te,a=await Y(e),s=Z(a,t),r=j(s),i=ae(await n.query(((e,t)=>{const n=["fr","nl","en"],a=n.reduce(((e,t)=>{const n=`?${t}Article`;return e[n]=`OPTIONAL {\n      ${n} schema:about ?place.\n      ${n} schema:isPartOf <https://${t}.wikipedia.org/>.\n    }`,e}),{}),s=ne.map((e=>`FILTER NOT EXISTS {?instance ${((e,t)=>{const n=[e?"wdt:P31":"",t?"wdt:P279":""];return e&&t?`${n.join("/")}?`:n.join("")})(e.instanceOf,e.subclassOf)} wd:${e.id}.}`));return`\n  SELECT ?place ?location ?placeLabel ?instanceLabel ?image ${Object.keys(a).join(" ")} ?prefArticle WHERE {\n    SERVICE wikibase:box {\n      ?place wdt:P625 ?location .\n      bd:serviceParam wikibase:cornerWest "Point(${e[0]} ${e[1]})"^^geo:wktLiteral .\n        bd:serviceParam wikibase:cornerEast "Point(${t[0]} ${t[1]})"^^geo:wktLiteral .\n      }\n    OPTIONAL {\n      ?place wdt:P31 ?instance.\n      ${s.join("\n")}\n    }\n    OPTIONAL { ?place wdt:P18 ?image. }\n    ${Object.values(a).join("\n")}\n    BIND(COALESCE(${Object.keys(a).join(", ")}, "") AS ?prefArticle)\n    FILTER (?prefArticle != "")\n    SERVICE wikibase:label { bd:serviceParam wikibase:language "${n.join(",")}". }\n  }`})([r[0],r[1]],[r[2],r[3]])));return P(i,s)};function re(e,t,n){const a=e.slice();return a[9]=t[n],a[11]=n,a}function ie(e){let t,n,a,s=ee,r=[];for(let i=0;i<s.length;i+=1)r[i]=ce(re(e,s,i));const o=e=>y(r[e],1,1,(()=>{r[e]=null}));return n=new _({props:{name:"wikidata",$$slots:{default:[le]},$$scope:{ctx:e}}}),n.$on("click",e[7]),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),L(n.$$.fragment)},l(e){for(let t=0;t<r.length;t+=1)r[t].l(e);t=T(e),N(n.$$.fragment,e)},m(e,s){for(let t=0;t<r.length;t+=1)r[t].m(e,s);i(e,t,s),q(n,e,s),a=!0},p(e,a){if(6&a){let n;for(s=ee,n=0;n<s.length;n+=1){const i=re(e,s,n);r[n]?(r[n].p(i,a),h(r[n],1)):(r[n]=ce(i),r[n].c(),h(r[n],1),r[n].m(t.parentNode,t))}for(W(),n=s.length;n<r.length;n+=1)o(n);S()}const i={};4096&a&&(i.$$scope={dirty:a,ctx:e}),n.$set(i)},i(e){if(!a){for(let e=0;e<s.length;e+=1)h(r[e]);h(n.$$.fragment,e),a=!0}},o(e){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)y(r[t]);y(n.$$.fragment,e),a=!1},d(e){R(r,e),e&&l(t),C(n,e)}}}function oe(e){let t,n=e[9].name+"";return{c(){t=F(n)},l(e){t=Q(e,n)},m(e,n){i(e,t,n)},p:c,d(e){e&&l(t)}}}function ce(e){let t,n;return t=new _({props:{name:e[9].name,$$slots:{default:[oe]},$$scope:{ctx:e}}}),t.$on("click",(function(){return e[6](e[9])})),{c(){L(t.$$.fragment)},l(e){N(t.$$.fragment,e)},m(e,a){q(t,e,a),n=!0},p(n,a){e=n;const s={};4096&a&&(s.$$scope={dirty:a,ctx:e}),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){y(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function le(e){let t;return{c(){t=F("Wikidata")},l(e){t=Q(e,"Wikidata")},m(e,n){i(e,t,n)},d(e){e&&l(t)}}}function ue(e){let t,n,c,u,p,f,m,$,g,b,w,O,v,k,E,j,P,R;function J(t){e[4](t)}let M={};void 0!==e[1]&&(M.files=e[1]),c=new G({props:M}),I.push((()=>x(c,"files",J)));let H=e[1]&&e[1][0]&&ie(e);return{c(){t=a("div"),n=a("div"),L(c.$$.fragment),p=A(),f=a("div"),m=a("label"),$=F("Within "),g=a("input"),b=F(" meters"),w=A(),O=a("div"),v=a("small"),k=F("Only values between 1 and 50000 are allowed"),E=A(),H&&H.c(),this.h()},l(e){t=s(e,"DIV",{class:!0});var a=d(t);n=s(a,"DIV",{});var r=d(n);N(c.$$.fragment,r),r.forEach(l),p=T(a),f=s(a,"DIV",{class:!0});var i=d(f);m=s(i,"LABEL",{});var o=d(m);$=Q(o,"Within "),g=s(o,"INPUT",{type:!0,max:!0}),b=Q(o," meters"),o.forEach(l),w=T(i),O=s(i,"DIV",{});var u=d(O);v=s(u,"SMALL",{});var h=d(v);k=Q(h,"Only values between 1 and 50000 are allowed"),h.forEach(l),u.forEach(l),i.forEach(l),E=T(a),H&&H.l(a),a.forEach(l),this.h()},h(){r(g,"type","number"),r(g,"max",de),r(f,"class","raduis"),r(t,"class","container svelte-a5c4d2")},m(a,s){i(a,t,s),V(t,n),q(c,n,null),V(t,p),V(t,f),V(f,m),V(m,$),V(m,g),B(g,e[0]),V(m,b),V(f,w),V(f,O),V(O,v),V(v,k),V(t,E),H&&H.m(t,null),j=!0,P||(R=o(g,"input",e[5]),P=!0)},p(e,[n]){const a={};!u&&2&n&&(u=!0,a.files=e[1],D((()=>u=!1))),c.$set(a),1&n&&U(g.value)!==e[0]&&B(g,e[0]),e[1]&&e[1][0]?H?(H.p(e,n),2&n&&h(H,1)):(H=ie(e),H.c(),h(H,1),H.m(t,null)):H&&(W(),y(H,1,1,(()=>{H=null})),S())},i(e){j||(h(c.$$.fragment,e),h(H),j=!0)},o(e){y(c.$$.fragment,e),y(H),j=!1},d(e){e&&l(t),C(c),H&&H.d(),P=!1,R()}}}const de=5e4;function pe(e,t,n){let a,s,r=1e3;const i=e=>{const t=e.split(".");return t.pop(),t.join(".")};return e.$$.update=()=>{1&e.$$.dirty&&(r<1?n(0,r=1):r>de&&n(0,r=de),n(2,s=r/1e3))},[r,a,s,i,function(e){a=e,n(1,a)},function(){r=U(this.value),n(0,r)},e=>z(a[0],e.query,a[0].name+" --- "+e.name,s),async()=>K(await se(a[0],s),`${i(a[0].name)}---wikidata`)]}class fe extends e{constructor(e){super(),t(this,e,pe,ue,n,{})}}export{fe as default};
