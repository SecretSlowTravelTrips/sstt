import{S as e,i as a,s as t,e as n,c as i,b as r,f as s,J as o,I as l,d as c,D as m,a as d,K as u,E as p,F as h,G as f,x as y,u as $,L as g,M as Q,N as v,O as b,P as w,Q as E,R as k,T as A,U as P,V as j,W as C,t as S,k as O,j as x,g as I,n as L,m as T,H as N,X as W,o as B,v as q,w as F,Y as R,Z as M,_ as D,r as H}from"../chunks/vendor-c2ec8e1b.js";function U(e){let a,t,m;return{c(){a=n("input"),this.h()},l(e){a=i(e,"INPUT",{type:!0,accept:!0}),this.h()},h(){r(a,"type","file"),r(a,"accept",".geojson,.gpx")},m(n,i){s(n,a,i),t||(m=o(a,"change",e[1]),t=!0)},p:l,i:l,o:l,d(e){e&&c(a),t=!1,m()}}}function V(e,a,t){let{files:n}=a;return e.$$set=e=>{"files"in e&&t(0,n=e.files)},[n,function(){n=this.files,t(0,n)}]}class J extends e{constructor(e){super(),a(this,e,V,U,t,{files:0})}}function _(e){let a,t,l,g;const Q=e[5].default,v=m(Q,e,e[4],null);return{c(){a=n("button"),v&&v.c(),this.h()},l(e){a=i(e,"BUTTON",{class:!0});var t=d(a);v&&v.l(t),t.forEach(c),this.h()},h(){r(a,"class","button"),u(a,"clicked",e[1]),u(a,"disabled",e[0])},m(n,i){s(n,a,i),v&&v.m(a,null),t=!0,l||(g=o(a,"click",e[2]),l=!0)},p(e,[n]){v&&v.p&&(!t||16&n)&&p(v,Q,e,e[4],t?f(Q,e[4],n,null):h(e[4]),null),2&n&&u(a,"clicked",e[1]),1&n&&u(a,"disabled",e[0])},i(e){t||(y(v,e),t=!0)},o(e){$(v,e),t=!1},d(e){e&&c(a),v&&v.d(e),l=!1,g()}}}function G(e,a,t){let{$$slots:n={},$$scope:i}=a,{name:r}=a,{disabled:s=!1}=a;const o=g();let l;return e.$$set=e=>{"name"in e&&t(3,r=e.name),"disabled"in e&&t(0,s=e.disabled),"$$scope"in e&&t(4,i=e.$$scope)},[s,l,e=>{if(t(1,l=!0),setTimeout((()=>t(1,l=!1)),100),!s)return o("click",r)},r,i,n]}class K extends e{constructor(e){super(),a(this,e,G,_,t,{name:3,disabled:0})}}var X=[{name:"Supermarket and convenience store",query:[{shop:"convenience"},{shop:"supermarket"}]},{name:"Bicycle shop",query:[{shop:"bicycle"}]},{name:"Playground",query:[{leisure:"playground"}]},{name:"Bakery",query:[{shop:"bakery"}]},{name:"Café and restaurant",query:[{amenity:"cafe"},{amenity:"restaurant"}]},{name:"Benches",query:[{amenity:"bench"}]}],Y=(e,a)=>{const t=a+".geojson";let n=JSON.stringify(e),i="data:application/json;charset=utf-8,"+encodeURIComponent(n),r=document.createElement("a");r.setAttribute("href",i),r.setAttribute("download",t),r.setAttribute("download",t),r.click(),r.remove()},Z=e=>new Promise(((a,t)=>{const n=e.name.split(".").pop();if(!e||"geojson"!==n&&"gpx"!==n)return t(new Error("Format not supported. Please provide a .geojson or .gpx."));{const i=new FileReader;i.addEventListener("load",(()=>{const e=i.result;return e?a("geojson"===n?JSON.parse(e):Q((new DOMParser).parseFromString(e,"text/xml"))):t(new Error("Could not read the provided file."))})),i.readAsText(e)}})),z=(e,a)=>{let t;if("FeatureCollection"===e.type)t=e.features[0];else{if("Feature"!==e.type)throw new Error("No Feature found in GeoJson");t=e}return v(t,a,{units:"kilometers"})},ee=async(e,a,t,n=1)=>{let i=await Z(e),r=z(i,n);console.log(r);let s=b(r,{highQuality:!0,mutate:!1,tolerance:.05});console.log(s);let o="";s.geometry.coordinates[0].map((e=>{o+=e[1]+" "+e[0]+" "})),o=o.trimEnd();let l="";a.map((e=>l+=`nwr["${Object.keys(e)[0]}"="${e[Object.keys(e)[0]]}"](poly:"${o}");`));const c=`[out:json][timeout:150];(${l});(._;>;);out center;`,m=await(async e=>{const a=await fetch("https://overpass-api.de/api/interpreter?data="+encodeURIComponent(e),{mode:"cors",headers:{"Content-Type":"application/json"}});if(!a.ok){const e=`An error has occured: ${a.status}`;throw new Error(e)}return await a.json()})(c);console.log(m);let d=w(m);console.log(d),Y(d,t)};class ae{constructor(e="https://query.wikidata.org/sparql"){this.endpoint=e}query(e,a=!0){const t=this.endpoint+"?query="+encodeURIComponent(e);return fetch(t,{headers:{Accept:"application/sparql-results+json"}}).then((e=>e.json())).then((e=>a?this.simplify(e):e))}simplify(e){return e.results.bindings.map((e=>(Object.keys(e).forEach((function(a){e[a]=e[a].value})),e)))}}var te=e=>E(e.map((e=>{const a=e.location.replace("Point(","").replace(")","").split(" ").map(Number);return delete e.location,k(a,e)}))),ne=async(e,a=1,t)=>{const n=new ae,i=await Z(e),r=z(i,a),s=A(r);return P(te(await n.query(((e,a,t=["fr","nl","en"])=>{const n=t.reduce(((e,a)=>{const t=`?${a}Article`;return e[t]=`OPTIONAL {\n      ${t} schema:about ?place.\n      ${t} schema:isPartOf <https://${a}.wikipedia.org/>.\n    }`,e}),{});return`\n  SELECT ?place ?location ?placeLabel ?instance ?instanceLabel ?image ${Object.keys(n).join(" ")} ?prefArticle WHERE {\n    SERVICE wikibase:box {\n      ?place wdt:P625 ?location .\n      bd:serviceParam wikibase:cornerWest "Point(${e[0]} ${e[1]})"^^geo:wktLiteral .\n        bd:serviceParam wikibase:cornerEast "Point(${a[0]} ${a[1]})"^^geo:wktLiteral .\n      }\n    OPTIONAL {\n      ?place wdt:P31 ?instance.\n    }\n    OPTIONAL { ?place wdt:P18 ?image. }\n    ${Object.values(n).join("\n")}\n    BIND(COALESCE(${Object.keys(n).join(", ")}, "") AS ?prefArticle)\n    FILTER (?prefArticle != "")\n    SERVICE wikibase:label { bd:serviceParam wikibase:language "${t.join(",")}". }\n  }`})([s[0],s[1]],[s[2],s[3]],t))),r)};var ie={architecture:{name:"Architecture & buildings",types:[{name:"Building",id:"Q41176"},{name:"Bridge",id:"Q12280"},{name:"Architectural structure",id:"Q811979"},{name:"Windmill",id:"Q38720"},{name:"City hall",id:"Q543654"},{name:"Belfry",id:"Q815448"},{name:"Cathedral",id:"Q2977"},{name:"Manor house",id:"Q879050"},{name:"War memorial",id:"Q575759"},{name:"Roman city",id:"Q2202509"}]},art:{name:"Art & Culture",types:[{name:"Museum",id:"Q33506"},{name:"Art museum",id:"Q207694"},{name:"Statue",id:"Q179700"},{name:"Archive",id:"Q166118"},{name:"Military museum",id:"Q2772772"},{name:"Heritage library",id:"Q2208411"},{name:"Theatre",id:"Q24354"},{name:"Sculpture",id:"Q860861"}]},bio:{name:"Bio & Permaculture",types:[]},food:{name:"Food & Drinks",types:[{name:"Abbey",id:"Q160742"},{name:"Brewery",id:"Q131734"}]},history:{name:"History",types:[{name:"Château",id:"Q751876"},{name:"Battle",id:"Q178561"},{name:"Commonwealth War Graves Commission maintained cemetery",id:"Q14750991"},{name:"Castle",id:"Q23413"},{name:"Abbey",id:"Q160742"},{name:"Monastery",id:"Q44613"},{name:"Fort",id:"Q1785071"},{name:"Statue",id:"Q179700"},{name:"Archive",id:"Q166118"},{name:"Siege",id:"Q188055"},{name:"Belfry",id:"Q815448"},{name:"Heritage library",id:"Q2208411"},{name:"Cathedral",id:"Q2977"},{name:"Sculpture",id:"Q860861"},{name:"Manor house",id:"Q879050"},{name:"War memorial",id:"Q575759"},{name:"Tumulus",id:"Q34023"},{name:"Enclave",id:"Q171441"},{name:"Roman city",id:"Q2202509"}]},miscellaneous:{name:"Hidden miscellaneous places ",types:[{name:"Tourist attraction",id:"Q570116"}]},nature:{name:"Wildlife & Nature",types:[{name:"Natural landscape",id:"Q1286517"},{name:"Forest",id:"Q4421"},{name:"Park",id:"Q22698"},{name:"Hill",id:"Q54050"},{name:"Mountain",id:"Q8502"}]},photography:{name:"Photography",types:[{name:"Windmill",id:"Q38720"},{name:"Tourist attraction",id:"Q570116"}]},religious:{name:"Religious buildings",types:[{name:"Parish church",id:"Q317557"},{name:"Chapel",id:"Q108325"},{name:"Church building",id:"Q16970"},{name:"Abbey",id:"Q160742"},{name:"Monastery",id:"Q44613"},{name:"Cathedral",id:"Q2977"}]},science:{name:"Science",types:[{name:"Federal scientific Institute",id:"Q2288140"}]},sports:{name:"Sports",types:[{name:"Association football venue",id:"Q1154710"},{name:"Stadium",id:"Q483110"}]},water:{name:"Seaside & water",types:[{name:"River",id:"Q4022"},{name:"Canal",id:"Q12284"},{name:"Main stream",id:"Q573344"},{name:"Stream",id:"Q47521"},{name:"Watermill",id:"Q185187"},{name:"Fountain",id:"Q483453"},{name:"Port settlement",id:"Q2264924"},{name:"Seaport",id:"Q15310171"}]}};function re(e,a,t){const n=e.slice();return n[16]=a[t],n[18]=t,n}function se(e){let a,t,l,m,u,p,h,f,g,Q,v,b,w,E,k,A,P,j,C=X,M=[];for(let n=0;n<C.length;n+=1)M[n]=le(re(e,C,n));const D=e=>$(M[e],1,1,(()=>{M[e]=null}));return k=new K({props:{name:"wikidata",$$slots:{default:[ce]},$$scope:{ctx:e}}}),k.$on("click",e[5]),{c(){a=n("h2"),t=S("Overpass"),l=O();for(let e=0;e<M.length;e+=1)M[e].c();m=O(),u=n("h2"),p=S("Wikidata"),h=O(),f=n("label"),g=n("input"),Q=O(),v=n("div"),b=n("small"),w=S("Enter each language code and separate them by a comma (,)."),E=O(),x(k.$$.fragment),this.h()},l(e){a=i(e,"H2",{});var n=d(a);t=I(n,"Overpass"),n.forEach(c),l=L(e);for(let a=0;a<M.length;a+=1)M[a].l(e);m=L(e),u=i(e,"H2",{});var r=d(u);p=I(r,"Wikidata"),r.forEach(c),h=L(e),f=i(e,"LABEL",{});var s=d(f);g=i(s,"INPUT",{type:!0}),Q=L(s),v=i(s,"DIV",{});var o=d(v);b=i(o,"SMALL",{});var y=d(b);w=I(y,"Enter each language code and separate them by a comma (,)."),y.forEach(c),o.forEach(c),s.forEach(c),E=L(e),T(k.$$.fragment,e),this.h()},h(){r(g,"type","text")},m(n,i){s(n,a,i),N(a,t),s(n,l,i);for(let e=0;e<M.length;e+=1)M[e].m(n,i);s(n,m,i),s(n,u,i),N(u,p),s(n,h,i),s(n,f,i),N(f,g),W(g,e[1]),N(f,Q),N(f,v),N(v,b),N(b,w),s(n,E,i),B(k,n,i),A=!0,P||(j=o(g,"input",e[9]),P=!0)},p(e,a){if(29&a){let t;for(C=X,t=0;t<C.length;t+=1){const n=re(e,C,t);M[t]?(M[t].p(n,a),y(M[t],1)):(M[t]=le(n),M[t].c(),y(M[t],1),M[t].m(m.parentNode,m))}for(H(),t=C.length;t<M.length;t+=1)D(t);F()}2&a&&g.value!==e[1]&&W(g,e[1]);const t={};524288&a&&(t.$$scope={dirty:a,ctx:e}),k.$set(t)},i(e){if(!A){for(let e=0;e<C.length;e+=1)y(M[e]);y(k.$$.fragment,e),A=!0}},o(e){M=M.filter(Boolean);for(let a=0;a<M.length;a+=1)$(M[a]);$(k.$$.fragment,e),A=!1},d(e){e&&c(a),e&&c(l),R(M,e),e&&c(m),e&&c(u),e&&c(h),e&&c(f),e&&c(E),q(k,e),P=!1,j()}}}function oe(e){let a,t=e[16].name+"";return{c(){a=S(t)},l(e){a=I(e,t)},m(e,t){s(e,a,t)},p:l,d(e){e&&c(a)}}}function le(e){let a,t;return a=new K({props:{name:e[16].name,$$slots:{default:[oe]},$$scope:{ctx:e}}}),a.$on("click",(function(){return e[8](e[16])})),{c(){x(a.$$.fragment)},l(e){T(a.$$.fragment,e)},m(e,n){B(a,e,n),t=!0},p(t,n){e=t;const i={};524288&n&&(i.$$scope={dirty:n,ctx:e}),a.$set(i)},i(e){t||(y(a.$$.fragment,e),t=!0)},o(e){$(a.$$.fragment,e),t=!1},d(e){q(a,e)}}}function ce(e){let a;return{c(){a=S("Wikidata")},l(e){a=I(e,"Wikidata")},m(e,t){s(e,a,t)},d(e){e&&c(a)}}}function me(e){let a,t,l,m,u,p,h,f,g,Q,v,b,w,E,k,A,P,R;function U(a){e[6](a)}let V={};void 0!==e[2]&&(V.files=e[2]),l=new J({props:V}),j.push((()=>C(l,"files",U)));let _=e[2]&&e[2][0]&&se(e);return{c(){a=n("div"),t=n("div"),x(l.$$.fragment),u=O(),p=n("div"),h=n("label"),f=S("Within "),g=n("input"),Q=S(" meters"),v=O(),b=n("div"),w=n("small"),E=S("Only values between 1 and 50000 are allowed"),k=O(),_&&_.c(),this.h()},l(e){a=i(e,"DIV",{class:!0});var n=d(a);t=i(n,"DIV",{});var r=d(t);T(l.$$.fragment,r),r.forEach(c),u=L(n),p=i(n,"DIV",{class:!0});var s=d(p);h=i(s,"LABEL",{});var o=d(h);f=I(o,"Within "),g=i(o,"INPUT",{type:!0,max:!0}),Q=I(o," meters"),o.forEach(c),v=L(s),b=i(s,"DIV",{});var m=d(b);w=i(m,"SMALL",{});var y=d(w);E=I(y,"Only values between 1 and 50000 are allowed"),y.forEach(c),m.forEach(c),s.forEach(c),k=L(n),_&&_.l(n),n.forEach(c),this.h()},h(){r(g,"type","number"),r(g,"max",de),r(p,"class","raduis"),r(a,"class","container svelte-a5c4d2")},m(n,i){s(n,a,i),N(a,t),B(l,t,null),N(a,u),N(a,p),N(p,h),N(h,f),N(h,g),W(g,e[0]),N(h,Q),N(p,v),N(p,b),N(b,w),N(w,E),N(a,k),_&&_.m(a,null),A=!0,P||(R=o(g,"input",e[7]),P=!0)},p(e,[t]){const n={};!m&&4&t&&(m=!0,n.files=e[2],M((()=>m=!1))),l.$set(n),1&t&&D(g.value)!==e[0]&&W(g,e[0]),e[2]&&e[2][0]?_?(_.p(e,t),4&t&&y(_,1)):(_=se(e),_.c(),y(_,1),_.m(a,null)):_&&(H(),$(_,1,1,(()=>{_=null})),F())},i(e){A||(y(l.$$.fragment,e),y(_),A=!0)},o(e){$(l.$$.fragment,e),$(_),A=!1},d(e){e&&c(a),q(l),_&&_.d(),P=!1,R()}}}const de=5e4;function ue(e,a,t){var n=this&&this.__awaiter||function(e,a,t,n){return new(t||(t=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(a){r(a)}}function o(e){try{l(n.throw(e))}catch(a){r(a)}}function l(e){var a;e.done?i(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(s,o)}l((n=n.apply(e,a||[])).next())}))};let i,r,s,o=1e3,l="fr, nl, en",c=(()=>{const e=new Set;for(const a in ie)for(const t of ie[a].types)e.add(t.id);return e})();const m=e=>{const a=e.split(".");return a.pop(),a.join(".")};return e.$$.update=()=>{1&e.$$.dirty&&(o<1?t(0,o=1):o>de&&t(0,o=de),t(3,r=o/1e3)),2&e.$$.dirty&&l&&(s=l.split(/[ ,]+/))},[o,l,i,r,m,()=>n(void 0,void 0,void 0,(function*(){var e,a;Y((e=yield ne(i[0],r,s),a=c,E(e.features.filter((({properties:e})=>e.instance&&a.has(e.instance.split("/").pop()))))),`${m(i[0].name)}---${o}m---wikidata`)})),function(e){i=e,t(2,i)},function(){o=D(this.value),t(0,o)},e=>ee(i[0],e.query,`${m(i[0].name)}---${o}m---${e.name}`,r),function(){l=this.value,t(1,l)}]}class pe extends e{constructor(e){super(),a(this,e,ue,me,t,{})}}export{pe as default};
