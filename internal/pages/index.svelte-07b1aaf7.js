import{S as e,i as t,s as a,e as n,c as s,b as r,f as i,J as o,I as c,d as l,D as u,a as d,K as p,E as f,F as m,G as h,x as $,u as y,L as g,M as b,N as v,O as w,P as O,Q as E,R as k,T as j,U as P,V as I,W as L,t as x,k as A,j as T,g as N,n as S,m as q,H as C,X as R,o as F,v as Q,w as V,Y as W,Z as B,_ as D,r as U}from"../chunks/vendor-52646ee1.js";function M(e){let t,a,u;return{c(){t=n("input"),this.h()},l(e){t=s(e,"INPUT",{type:!0,accept:!0}),this.h()},h(){r(t,"type","file"),r(t,"accept",".geojson,.gpx")},m(n,s){i(n,t,s),a||(u=o(t,"change",e[1]),a=!0)},p:c,i:c,o:c,d(e){e&&l(t),a=!1,u()}}}function H(e,t,a){let{files:n}=t;return e.$$set=e=>{"files"in e&&a(0,n=e.files)},[n,function(){n=this.files,a(0,n)}]}class J extends e{constructor(e){super(),t(this,e,H,M,a,{files:0})}}function G(e){let t,a,c,g;const b=e[5].default,v=u(b,e,e[4],null);return{c(){t=n("button"),v&&v.c(),this.h()},l(e){t=s(e,"BUTTON",{class:!0});var a=d(t);v&&v.l(a),a.forEach(l),this.h()},h(){r(t,"class","button"),p(t,"clicked",e[1]),p(t,"disabled",e[0])},m(n,s){i(n,t,s),v&&v.m(t,null),a=!0,c||(g=o(t,"click",e[2]),c=!0)},p(e,[n]){v&&v.p&&(!a||16&n)&&f(v,b,e,e[4],a?h(b,e[4],n,null):m(e[4]),null),2&n&&p(t,"clicked",e[1]),1&n&&p(t,"disabled",e[0])},i(e){a||($(v,e),a=!0)},o(e){y(v,e),a=!1},d(e){e&&l(t),v&&v.d(e),c=!1,g()}}}function X(e,t,a){let{$$slots:n={},$$scope:s}=t,{name:r}=t,{disabled:i=!1}=t;const o=g();let c;return e.$$set=e=>{"name"in e&&a(3,r=e.name),"disabled"in e&&a(0,i=e.disabled),"$$scope"in e&&a(4,s=e.$$scope)},[i,c,e=>{if(a(1,c=!0),setTimeout((()=>a(1,c=!1)),100),!i)return o("click",r)},r,s,n]}class _ extends e{constructor(e){super(),t(this,e,X,G,a,{name:3,disabled:0})}}var K=(e,t)=>{const a=t+".geojson";let n=JSON.stringify(e),s="data:application/json;charset=utf-8,"+encodeURIComponent(n),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",a),r.setAttribute("download",a),r.click(),r.remove()},Y=e=>new Promise(((t,a)=>{const n=e.name.split(".").pop();if(!e||"geojson"!==n&&"gpx"!==n)return a(new Error("Format not supported. Please provide a .geojson or .gpx."));{const s=new FileReader;s.addEventListener("load",(()=>{const e=s.result;return e?t("geojson"===n?JSON.parse(e):b((new DOMParser).parseFromString(e,"text/xml"))):a(new Error("Could not read the provided file."))})),s.readAsText(e)}})),Z=(e,t)=>{let a;if("FeatureCollection"===e.type)a=e.features[0];else{if("Feature"!==e.type)throw new Error("No Feature found in GeoJson");a=e}return v(a,t,{units:"kilometers"})},z=async(e,t,a,n=1)=>{let s=await Y(e),r=Z(s,n);console.log(r);let i=w(r,{highQuality:!0,mutate:!1,tolerance:.05});console.log(i);let o="";i.geometry.coordinates[0].map((e=>{o+=e[1]+" "+e[0]+" "})),o=o.trimEnd();let c="";t.map((e=>c+=`way["${Object.keys(e)[0]}"="${e[Object.keys(e)[0]]}"](poly:"${o}");`));const l=`[out:json][timeout:150];(${c});(._;>;);out meta;`,u=await(async e=>{const t=await fetch("https://overpass-api.de/api/interpreter?data="+encodeURIComponent(e),{mode:"cors",headers:{"Content-Type":"application/json"}});return await t.json()})(l);console.log(u);let d=O(u);console.log(d),K(d,a)};var ee=[{name:"Supermarket and convenience store",query:[{shop:"convenience"},{shop:"supermarket"}]},{name:"Bicycle shop",query:[{shop:"bicycle"}]},{name:"Playground",query:[{leisure:"playground"}]},{name:"Bakery",query:[{shop:"bakery"}]},{name:"CafÃ© and restaurant",query:[{amenity:"cafe"},{amenity:"restaurant"}]},{name:"Benches",query:[{amenity:"bench"}]}];class te{constructor(e="https://query.wikidata.org/sparql"){this.endpoint=e}query(e,t=!0){const a=this.endpoint+"?query="+encodeURIComponent(e);return fetch(a,{headers:{Accept:"application/sparql-results+json"}}).then((e=>e.json())).then((e=>t?this.simplify(e):e))}simplify(e){return e.results.bindings.map((e=>(Object.keys(e).forEach((function(t,a){e[t]=e[t].value})),e)))}}var ae=[{name:"Road",id:"Q34442",instanceOf:!0,subclassOf:!0},{name:"Cemetery",id:"Q39614",instanceOf:!0,subclassOf:!0},{name:"Accident",id:"Q171558",instanceOf:!0,subclassOf:!0},{name:"Farmhouse",id:"Q489357",instanceOf:!0,subclassOf:!0},{name:"Municipality section",id:"Q2785216",instanceOf:!0,subclassOf:!0},{name:"Viaduc",id:"Q181348",instanceOf:!0,subclassOf:!0},{name:"Railway tunnel",id:"Q1311958",instanceOf:!0,subclassOf:!0},{name:"Prisons",id:"Q40357",instanceOf:!0,subclassOf:!0}];var ne=e=>E(e.map((e=>{const t=e.location.replace("Point(","").replace(")","").split(" ").map(Number);return delete e.location,k(t,e)}))),se=async(e,t=1,a)=>{const n=new te,s=await Y(e),r=Z(s,t),i=j(r),o=ne(await n.query(((e,t,a=["fr","nl","en"])=>{const n=a.reduce(((e,t)=>{const a=`?${t}Article`;return e[a]=`OPTIONAL {\n      ${a} schema:about ?place.\n      ${a} schema:isPartOf <https://${t}.wikipedia.org/>.\n    }`,e}),{}),s=ae.map((e=>`FILTER NOT EXISTS {?place ${((e,t)=>{const a=[e?"wdt:P31":"",t?"wdt:P279":""];return e&&t?`${a.join("/")}?`:a.join("")})(e.instanceOf,e.subclassOf)} wd:${e.id}.}`));return`\n  SELECT ?place ?location ?placeLabel ?instanceLabel ?image ${Object.keys(n).join(" ")} ?prefArticle WHERE {\n    SERVICE wikibase:box {\n      ?place wdt:P625 ?location .\n      bd:serviceParam wikibase:cornerWest "Point(${e[0]} ${e[1]})"^^geo:wktLiteral .\n        bd:serviceParam wikibase:cornerEast "Point(${t[0]} ${t[1]})"^^geo:wktLiteral .\n      }\n    OPTIONAL {\n      ?place wdt:P31 ?instance.\n    }\n    ${s.join("\n")}\n    OPTIONAL { ?place wdt:P18 ?image. }\n    ${Object.values(n).join("\n")}\n    BIND(COALESCE(${Object.keys(n).join(", ")}, "") AS ?prefArticle)\n    FILTER (?prefArticle != "")\n    SERVICE wikibase:label { bd:serviceParam wikibase:language "${a.join(",")}". }\n  }`})([i[0],i[1]],[i[2],i[3]],a)));return P(o,r)};function re(e,t,a){const n=e.slice();return n[12]=t[a],n[14]=a,n}function ie(e){let t,a,c,u,p,f,m,h,g,b,v,w,O,E,k,j,P,I,L=ee,B=[];for(let n=0;n<L.length;n+=1)B[n]=ce(re(e,L,n));const D=e=>y(B[e],1,1,(()=>{B[e]=null}));return k=new _({props:{name:"wikidata",$$slots:{default:[le]},$$scope:{ctx:e}}}),k.$on("click",e[10]),{c(){t=n("h2"),a=x("Overpass"),c=A();for(let e=0;e<B.length;e+=1)B[e].c();u=A(),p=n("h2"),f=x("Wikidata"),m=A(),h=n("label"),g=n("input"),b=A(),v=n("div"),w=n("small"),O=x("Enter each language code and separate them by a comma (,)."),E=A(),T(k.$$.fragment),this.h()},l(e){t=s(e,"H2",{});var n=d(t);a=N(n,"Overpass"),n.forEach(l),c=S(e);for(let t=0;t<B.length;t+=1)B[t].l(e);u=S(e),p=s(e,"H2",{});var r=d(p);f=N(r,"Wikidata"),r.forEach(l),m=S(e),h=s(e,"LABEL",{});var i=d(h);g=s(i,"INPUT",{type:!0}),b=S(i),v=s(i,"DIV",{});var o=d(v);w=s(o,"SMALL",{});var $=d(w);O=N($,"Enter each language code and separate them by a comma (,)."),$.forEach(l),o.forEach(l),i.forEach(l),E=S(e),q(k.$$.fragment,e),this.h()},h(){r(g,"type","text")},m(n,s){i(n,t,s),C(t,a),i(n,c,s);for(let e=0;e<B.length;e+=1)B[e].m(n,s);i(n,u,s),i(n,p,s),C(p,f),i(n,m,s),i(n,h,s),C(h,g),R(g,e[1]),C(h,b),C(h,v),C(v,w),C(w,O),i(n,E,s),F(k,n,s),j=!0,P||(I=o(g,"input",e[9]),P=!0)},p(e,t){if(12&t){let a;for(L=ee,a=0;a<L.length;a+=1){const n=re(e,L,a);B[a]?(B[a].p(n,t),$(B[a],1)):(B[a]=ce(n),B[a].c(),$(B[a],1),B[a].m(u.parentNode,u))}for(U(),a=L.length;a<B.length;a+=1)D(a);V()}2&t&&g.value!==e[1]&&R(g,e[1]);const a={};32768&t&&(a.$$scope={dirty:t,ctx:e}),k.$set(a)},i(e){if(!j){for(let e=0;e<L.length;e+=1)$(B[e]);$(k.$$.fragment,e),j=!0}},o(e){B=B.filter(Boolean);for(let t=0;t<B.length;t+=1)y(B[t]);y(k.$$.fragment,e),j=!1},d(e){e&&l(t),e&&l(c),W(B,e),e&&l(u),e&&l(p),e&&l(m),e&&l(h),e&&l(E),Q(k,e),P=!1,I()}}}function oe(e){let t,a=e[12].name+"";return{c(){t=x(a)},l(e){t=N(e,a)},m(e,a){i(e,t,a)},p:c,d(e){e&&l(t)}}}function ce(e){let t,a;return t=new _({props:{name:e[12].name,$$slots:{default:[oe]},$$scope:{ctx:e}}}),t.$on("click",(function(){return e[8](e[12])})),{c(){T(t.$$.fragment)},l(e){q(t.$$.fragment,e)},m(e,n){F(t,e,n),a=!0},p(a,n){e=a;const s={};32768&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){a||($(t.$$.fragment,e),a=!0)},o(e){y(t.$$.fragment,e),a=!1},d(e){Q(t,e)}}}function le(e){let t;return{c(){t=x("Wikidata")},l(e){t=N(e,"Wikidata")},m(e,a){i(e,t,a)},d(e){e&&l(t)}}}function ue(e){let t,a,c,u,p,f,m,h,g,b,v,w,O,E,k,j,P,W;function M(t){e[6](t)}let H={};void 0!==e[2]&&(H.files=e[2]),c=new J({props:H}),I.push((()=>L(c,"files",M)));let G=e[2]&&e[2][0]&&ie(e);return{c(){t=n("div"),a=n("div"),T(c.$$.fragment),p=A(),f=n("div"),m=n("label"),h=x("Within "),g=n("input"),b=x(" meters"),v=A(),w=n("div"),O=n("small"),E=x("Only values between 1 and 50000 are allowed"),k=A(),G&&G.c(),this.h()},l(e){t=s(e,"DIV",{class:!0});var n=d(t);a=s(n,"DIV",{});var r=d(a);q(c.$$.fragment,r),r.forEach(l),p=S(n),f=s(n,"DIV",{class:!0});var i=d(f);m=s(i,"LABEL",{});var o=d(m);h=N(o,"Within "),g=s(o,"INPUT",{type:!0,max:!0}),b=N(o," meters"),o.forEach(l),v=S(i),w=s(i,"DIV",{});var u=d(w);O=s(u,"SMALL",{});var $=d(O);E=N($,"Only values between 1 and 50000 are allowed"),$.forEach(l),u.forEach(l),i.forEach(l),k=S(n),G&&G.l(n),n.forEach(l),this.h()},h(){r(g,"type","number"),r(g,"max",de),r(f,"class","raduis"),r(t,"class","container svelte-a5c4d2")},m(n,s){i(n,t,s),C(t,a),F(c,a,null),C(t,p),C(t,f),C(f,m),C(m,h),C(m,g),R(g,e[0]),C(m,b),C(f,v),C(f,w),C(w,O),C(O,E),C(t,k),G&&G.m(t,null),j=!0,P||(W=o(g,"input",e[7]),P=!0)},p(e,[a]){const n={};!u&&4&a&&(u=!0,n.files=e[2],B((()=>u=!1))),c.$set(n),1&a&&D(g.value)!==e[0]&&R(g,e[0]),e[2]&&e[2][0]?G?(G.p(e,a),4&a&&$(G,1)):(G=ie(e),G.c(),$(G,1),G.m(t,null)):G&&(U(),y(G,1,1,(()=>{G=null})),V())},i(e){j||($(c.$$.fragment,e),$(G),j=!0)},o(e){y(c.$$.fragment,e),y(G),j=!1},d(e){e&&l(t),Q(c),G&&G.d(),P=!1,W()}}}const de=5e4;function pe(e,t,a){let n,s,r,i=1e3,o="fr, nl, en";const c=e=>{const t=e.split(".");return t.pop(),t.join(".")};return e.$$.update=()=>{1&e.$$.dirty&&(i<1?a(0,i=1):i>de&&a(0,i=de),a(3,s=i/1e3)),2&e.$$.dirty&&o&&a(4,r=o.split(/[ ,]+/))},[i,o,n,s,r,c,function(e){n=e,a(2,n)},function(){i=D(this.value),a(0,i)},e=>z(n[0],e.query,n[0].name+" --- "+e.name,s),function(){o=this.value,a(1,o)},async()=>K(await se(n[0],s,r),`${c(n[0].name)}---wikidata`)]}class fe extends e{constructor(e){super(),t(this,e,pe,ue,a,{})}}export{fe as default};
